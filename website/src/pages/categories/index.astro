---
import { getCollection } from "astro:content";
import Base from "../../layouts/Base.astro";
import Breadcrumbs from "../../components/Breadcrumbs.astro";
import CategoryCard from "../../components/CategoryCard.astro";

const allLore = await getCollection("lore");

const categoryCounts = allLore.reduce(
  (acc, entry) => {
    const cat = entry.data.category;
    acc[cat] = (acc[cat] || 0) + 1;
    return acc;
  },
  {} as Record<string, number>,
);

const sortedCategories = Object.entries(categoryCounts).sort((a, b) => a[0].localeCompare(b[0]));
---

<Base title="Categories" description="Browse all lore categories in The Whisker Shogunate.">
  <div class="page">
    <header class="page__header">
      <div class="page__header-inner">
        <Breadcrumbs
          items={[
            { label: "Home", href: `${import.meta.env.BASE_URL}` },
            { label: "Categories" },
          ]}
        />

        <div class="page__title-section">
          <h1 class="page__title">All Categories</h1>
          <p class="page__description">
            Browse {allLore.length} lore entries across {sortedCategories.length} categories.
            Each category contains detailed information about different aspects of Neko-kuni.
          </p>
        </div>
      </div>
    </header>

    <main class="page__content">
      <div class="page__grid stagger-children">
        {sortedCategories.map(([category, count]) => (
          <CategoryCard category={category} count={count} size="large" />
        ))}
      </div>
    </main>
  </div>
</Base>

<style>
  .page__header {
    background-color: var(--color-bg-secondary);
    border-bottom: 1px solid var(--color-border);
    padding: var(--space-8) var(--space-4) var(--space-12);
  }

  @media (min-width: 768px) {
    .page__header {
      padding: var(--space-10) var(--space-8) var(--space-16);
    }
  }

  .page__header-inner {
    max-width: var(--max-width-content);
    margin-inline: auto;
  }

  .page__title-section {
    margin-top: var(--space-8);
  }

  .page__title {
    font-family: var(--font-display);
    font-size: var(--text-4xl);
    font-weight: 500;
    color: var(--color-text-primary);
    margin: 0 0 var(--space-4) 0;
  }

  @media (min-width: 768px) {
    .page__title {
      font-size: var(--text-5xl);
    }
  }

  .page__description {
    font-size: var(--text-lg);
    color: var(--color-text-secondary);
    max-width: 600px;
    line-height: var(--leading-relaxed);
    margin: 0;
  }

  .page__content {
    padding: var(--space-8) var(--space-4);
    max-width: var(--max-width-wide);
    margin-inline: auto;
  }

  @media (min-width: 768px) {
    .page__content {
      padding: var(--space-12) var(--space-8);
    }
  }

  .page__grid {
    display: grid;
    gap: var(--space-5);
  }

  @media (min-width: 640px) {
    .page__grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (min-width: 1200px) {
    .page__grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }
</style>
